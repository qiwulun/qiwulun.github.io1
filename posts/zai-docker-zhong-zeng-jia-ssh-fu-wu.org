# -*- mode: Org; org-download-image-dir: "../images"; -*-
#+BEGIN_COMMENT
.. title: 在 docker 中增加 ssh 服务
.. slug: zai-docker-zhong-zeng-jia-ssh-fu-wu
.. date: 2016-12-05 14:00:31 UTC+08:00
.. tags: docker, ssh
.. category: 
.. link: 
.. description: 
.. type: text
#+END_COMMENT
#+OPTIONS: toc:nil
参考 http://www.linuxdiyf.com/linux/15472.html

#+BEGIN_SRC bash
# 1 先在宿主机上运行一个已有的镜像 
docker run -it ubuntu bash
# 如果已经有其它的基础镜像也可以代替上面的ubuntu

# 2 在container上运行下列命令
# 2.1 安装ssh服务
apt-get update #更新源
apt-get install ssh

# 2.2 配置密码
# 使用 passwd 来配置 ssh 登录时需要的密码
passwd
# 按提示进行修改

# 2.3 修改sshd_config配置文件
vi /etc/ssh/sshd_config
# 将PermitRootLogin 改为 yes，将UsePAM 改为 no。

# 2.4 退出 container
exit

# 3. [可选] 在宿主机上把此镜像保存一下：
# 3.1 把容器保存成镜像
docker commit [container-id] [image-id]
# 3.2 把刚刚的容器干掉：
docker stop [container-id] #停用
docker rm [container-id]   #删除

# 4 在宿主机上启动container 并挂载端口：
docker run --name [container-name] -i -t -p 50001:22 [image-id]
# 把 ssh 默认端口22 挂载到宿主机的 50001 端口上

# 5 在container上启动ssh服务：
/etc/init.d/ssh start
# C-p C-q 组合键退出会话，不关闭container

# 6 在其他电脑上使用ssh登录即可
ssh [rootname]@[hostip] -p 50001
# 输入 rootpasscode
#+END_SRC

想要以后台方式启动的话，要写一个自启动 ssh 的脚本
=docker run -d -p 22:22 -t centos6.5:sshd /root/run.sh=

* TODO 其它的设置
Docker网络管理及容器跨主机通信（四）
http://lizhenliang.blog.51cto.com/7876557/1731898

docker高级应用之赋予容器独立外网ip
http://dl528888.blog.51cto.com/2382721/1604167
