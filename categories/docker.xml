<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>赵骥's Site (docker)</title><link>https://qiwulun.github.io/</link><description></description><atom:link href="https://qiwulun.github.io/categories/docker.xml" rel="self" type="application/rss+xml"></atom:link><language>zh_cn</language><lastBuildDate>Wed, 07 Dec 2016 12:04:00 GMT</lastBuildDate><generator>https://getnikola.com/</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>在 docker 中增加 ssh 服务</title><link>https://qiwulun.github.io/posts/zai-docker-zhong-zeng-jia-ssh-fu-wu.html</link><dc:creator>Zhao JI</dc:creator><description>&lt;p&gt;
参考 &lt;a href="http://www.linuxdiyf.com/linux/15472.html"&gt;http://www.linuxdiyf.com/linux/15472.html&lt;/a&gt;
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# 1 先在宿主机上运行一个已有的镜像 
docker run -it ubuntu bash
# 如果已经有其它的基础镜像也可以代替上面的ubuntu

# 2 在container上运行下列命令
# 2.1 安装ssh服务
apt-get update #更新源
apt-get install ssh

# 2.2 配置密码
# 使用 passwd 来配置 ssh 登录时需要的密码
passwd
# 按提示进行修改

# 2.3 修改sshd_config配置文件
vi /etc/ssh/sshd_config
# 将PermitRootLogin 改为 yes，将UsePAM 改为 no。

# 2.4 退出 container
exit

# 3. [可选] 在宿主机上把此镜像保存一下：
# 3.1 把容器保存成镜像
docker commit [container-id] [image-id]
# 3.2 把刚刚的容器干掉：
docker stop [container-id] #停用
docker rm [container-id]   #删除

# 4 在宿主机上启动container 并挂载端口：
docker run --name [container-name] -i -t -p 50001:22 [image-id]
# 把 ssh 默认端口22 挂载到宿主机的 50001 端口上

# 5 在container上启动ssh服务：
/etc/init.d/ssh start
# C-p C-q 组合键退出会话，不关闭container

# 6 在其他电脑上使用ssh登录即可
ssh [rootname]@[hostip] -p 50001
# 输入 rootpasscode
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
想要以后台方式启动的话，要写一个自启动 ssh 的脚本
&lt;code&gt;docker run -d -p 22:22 -t centos6.5:sshd /root/run.sh&lt;/code&gt;
&lt;/p&gt;

&lt;div id="outline-container-sec-1" class="outline-2"&gt;
&lt;h2 id="sec-1"&gt;&lt;span class="todo TODO"&gt;TODO&lt;/span&gt; 其它的设置&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-1"&gt;
&lt;p&gt;
Docker网络管理及容器跨主机通信（四）
&lt;a href="http://lizhenliang.blog.51cto.com/7876557/1731898"&gt;http://lizhenliang.blog.51cto.com/7876557/1731898&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
docker高级应用之赋予容器独立外网ip
&lt;a href="http://dl528888.blog.51cto.com/2382721/1604167"&gt;http://dl528888.blog.51cto.com/2382721/1604167&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-sec-2" class="outline-2"&gt;
&lt;h2 id="sec-2"&gt;报错&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-2"&gt;
&lt;p&gt;
Cannot connect to the Docker daemon. Is the docker daemon running on this host?
&lt;/p&gt;

&lt;p&gt;
要把用户加到group中
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo usermod -aG docker &amp;lt;username&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
操作顺序: 
&lt;/p&gt;
&lt;ol class="org-ol"&gt;
&lt;li&gt;sudo cat /etc/group | grep docker 
&lt;/li&gt;
&lt;li&gt;如果不存在docker组，可以添加sudo groupadd docker 
&lt;/li&gt;
&lt;li&gt;添加当前用户到docker组，sudo gpasswd -a ${USER} docker
&lt;/li&gt;
&lt;li&gt;ssh 登出，再重新登录即可
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>docker</category><category>ssh</category><guid>https://qiwulun.github.io/posts/zai-docker-zhong-zeng-jia-ssh-fu-wu.html</guid><pubDate>Mon, 05 Dec 2016 06:00:31 GMT</pubDate></item></channel></rss>